//@version=5
indicator("ðŸ”” Advanced Alert Conditions - Bounce Indicator Companion", overlay=false)

// =====================================================
// ADVANCED ALERT CONDITIONS FOR BOUNCE INDICATOR
// =====================================================

// Import settings (match your main indicator)
rsiLength = input.int(14, "RSI Length", group="Settings")
volumeMA = input.int(20, "Volume MA", group="Settings") 
volumeThreshold = input.float(1.5, "Volume Threshold", group="Settings")

// Alert toggles
enablePreSignalAlerts = input.bool(true, "Pre-Signal Alerts (Setup Building)", group="ðŸ”” Alert Types")
enableBreakdownAlerts = input.bool(true, "Breakdown Alerts (Failed Bounce)", group="ðŸ”” Alert Types")
enableTrendChangeAlerts = input.bool(true, "Trend Change Alerts", group="ðŸ”” Alert Types")
enableVolumeAnomalyAlerts = input.bool(false, "Volume Anomaly Alerts", group="ðŸ”” Alert Types")
enableNewsAvoidanceAlerts = input.bool(false, "High-Impact News Alerts", group="ðŸ”” Alert Types")

// =====================================================
// CALCULATIONS
// =====================================================

rsi = ta.rsi(close, rsiLength)
avgVolume = ta.sma(volume, volumeMA)
volumeRatio = volume / avgVolume

ema21 = ta.ema(close, 21)
ema50 = ta.ema(close, 50)
ema200 = ta.ema(close, 200)

atr = ta.atr(14)

// =====================================================
// ADVANCED ALERT CONDITIONS
// =====================================================

// 1. PRE-SIGNAL ALERTS (Setup is building)
setupBuilding = rsi < 40 and rsi > rsi[1] and close < ema21 and close > ema21 - atr * 0.5
alertcondition(enablePreSignalAlerts and setupBuilding, 
               title="ðŸ”¶ Setup Building Alert", 
               message="Bounce setup is building - Watch for confluence factors!\nSymbol: {{ticker}}\nPrice: {{close}}\nRSI: " + str.tostring(rsi, "#.#"))

// 2. BREAKDOWN ALERTS (Failed bounce)
failedBounce = close < ta.lowest(low, 5) and rsi[1] < 35 and volumeRatio > 1.2
alertcondition(enableBreakdownAlerts and failedBounce,
               title="ðŸ”» Failed Bounce Alert",
               message="Bounce attempt failed - Consider short or exit longs!\nSymbol: {{ticker}}\nPrice: {{close}}\nBreakdown confirmed")

// 3. TREND CHANGE ALERTS  
trendChangeUp = ta.crossover(ema21, ema50) and close > ema21
trendChangeDown = ta.crossunder(ema21, ema50) and close < ema21
alertcondition(enableTrendChangeAlerts and trendChangeUp,
               title="ðŸ“ˆ Bullish Trend Change",
               message="BULLISH trend change detected - Bounce signals will be more reliable!\nSymbol: {{ticker}}")
alertcondition(enableTrendChangeAlerts and trendChangeDown,
               title="ðŸ“‰ Bearish Trend Change", 
               message="BEARISH trend change - Avoid bounce signals!\nSymbol: {{ticker}}")

// 4. VOLUME ANOMALY ALERTS
extremeVolume = volumeRatio > 3.0
unusualVolume = volumeRatio > 2.5 and volumeRatio < 3.0
alertcondition(enableVolumeAnomalyAlerts and extremeVolume,
               title="ðŸ’¥ Extreme Volume Alert",
               message="EXTREME volume detected - Major move incoming!\nSymbol: {{ticker}}\nVolume: " + str.tostring(volumeRatio, "#.#") + "x average")
alertcondition(enableVolumeAnomalyAlerts and unusualVolume,
               title="ðŸ“Š Unusual Volume Alert", 
               message="Unusual volume activity - Monitor closely!\nSymbol: {{ticker}}\nVolume: " + str.tostring(volumeRatio, "#.#") + "x average")

// 5. RSI DIVERGENCE ALERTS
rsiDivergenceBullish = ta.pivotlow(rsi, 2, 2) and ta.pivotlow(close, 2, 2) and 
                       rsi > rsi[4] and close < close[4]
alertcondition(rsiDivergenceBullish,
               title="ðŸ“ˆ Bullish RSI Divergence",
               message="Bullish RSI divergence detected - Bounce potential increasing!\nSymbol: {{ticker}}")

// 6. SUPPORT BREAK ALERTS  
supportBreak = close < ta.lowest(low, 20) and volumeRatio > 1.3
alertcondition(supportBreak,
               title="ðŸ”» Support Break Alert",
               message="Key support broken with volume - Avoid longs!\nSymbol: {{ticker}}\nPrice: {{close}}")

// 7. MOMENTUM SHIFT ALERTS
momentumShiftUp = rsi[2] < 30 and rsi[1] < 30 and rsi > 35 and close > open
alertcondition(momentumShiftUp,
               title="âš¡ Momentum Shift Up",
               message="Momentum shifting from oversold - Bounce incoming!\nSymbol: {{ticker}}\nRSI: " + str.tostring(rsi, "#.#"))

// 8. CONFLUENCE BUILDING ALERTS
confluenceBuilding = (close < ema21 * 1.02 and close > ema21 * 0.98) and rsi < 35 and volumeRatio > 1.2
alertcondition(confluenceBuilding,
               title="ðŸŽ¯ Confluence Building",
               message="Multiple factors aligning - Prepare for potential bounce!\nSymbol: {{ticker}}")

// =====================================================
// VISUAL INDICATORS
// =====================================================

plot(rsi, "RSI", color=color.purple)
hline(30, "Oversold", color=color.red, linestyle=hline.style_dashed)
hline(70, "Overbought", color=color.green, linestyle=hline.style_dashed)
hline(50, "Midline", color=color.gray)

plot(volumeRatio, "Volume Ratio", color=color.blue, display=display.data_window)
hline(1.5, "Volume Threshold", color=color.orange, linestyle=hline.style_dotted)

// Background for setup building
bgcolor(setupBuilding ? color.new(color.yellow, 90) : na, title="Setup Building")
bgcolor(failedBounce ? color.new(color.red, 90) : na, title="Failed Bounce")
bgcolor(confluenceBuilding ? color.new(color.green, 95) : na, title="Confluence Building")

// =====================================================
// ALERT SUMMARY TABLE
// =====================================================

var table alertTable = table.new(position.bottom_left, 2, 9, bgcolor=color.new(color.black, 80), border_width=1)

if barstate.islast
    table.cell(alertTable, 0, 0, "ðŸ”” ALERT STATUS", text_color=color.white, text_size=size.small)
    table.cell(alertTable, 1, 0, "ACTIVE", text_color=color.white, text_size=size.small)
    
    table.cell(alertTable, 0, 1, "Setup Building", text_color=color.white, text_size=size.tiny)
    table.cell(alertTable, 1, 1, setupBuilding ? "ðŸŸ¡ YES" : "âšª NO", text_color=color.white, text_size=size.tiny)
    
    table.cell(alertTable, 0, 2, "Failed Bounce", text_color=color.white, text_size=size.tiny)
    table.cell(alertTable, 1, 2, failedBounce ? "ðŸ”´ YES" : "âšª NO", text_color=color.white, text_size=size.tiny)
    
    table.cell(alertTable, 0, 3, "Trend Change", text_color=color.white, text_size=size.tiny)
    table.cell(alertTable, 1, 3, (trendChangeUp or trendChangeDown) ? "ðŸŸ  YES" : "âšª NO", text_color=color.white, text_size=size.tiny)
    
    table.cell(alertTable, 0, 4, "Volume Anomaly", text_color=color.white, text_size=size.tiny)
    table.cell(alertTable, 1, 4, (extremeVolume or unusualVolume) ? "ðŸ”µ YES" : "âšª NO", text_color=color.white, text_size=size.tiny)
    
    table.cell(alertTable, 0, 5, "RSI Divergence", text_color=color.white, text_size=size.tiny)
    table.cell(alertTable, 1, 5, rsiDivergenceBullish ? "ðŸŸ¢ YES" : "âšª NO", text_color=color.white, text_size=size.tiny)
    
    table.cell(alertTable, 0, 6, "Support Break", text_color=color.white, text_size=size.tiny)
    table.cell(alertTable, 1, 6, supportBreak ? "ðŸ”´ YES" : "âšª NO", text_color=color.white, text_size=size.tiny)
    
    table.cell(alertTable, 0, 7, "Momentum Shift", text_color=color.white, text_size=size.tiny)
    table.cell(alertTable, 1, 7, momentumShiftUp ? "âš¡ YES" : "âšª NO", text_color=color.white, text_size=size.tiny)
    
    table.cell(alertTable, 0, 8, "Confluence Build", text_color=color.white, text_size=size.tiny)
    table.cell(alertTable, 1, 8, confluenceBuilding ? "ðŸŽ¯ YES" : "âšª NO", text_color=color.white, text_size=size.tiny)

// =====================================================
// ALERT INSTRUCTIONS
// =====================================================

// This companion indicator provides 8 additional alert types:
// 1. ðŸ”¶ Setup Building - Early warning that conditions are aligning
// 2. ðŸ”» Failed Bounce - Alert when bounce attempts fail (exit/short opportunity) 
// 3. ðŸ“ˆðŸ“‰ Trend Change - Major trend shifts that affect bounce reliability
// 4. ðŸ’¥ðŸ“Š Volume Anomalies - Extreme/unusual volume for early smart money detection
// 5. ðŸ“ˆ RSI Divergence - Bullish divergence for bounce confirmation
// 6. ðŸ”» Support Break - Key support failures (avoid longs)
// 7. âš¡ Momentum Shift - RSI momentum turning up from oversold
// 8. ðŸŽ¯ Confluence Building - Multiple factors starting to align

// USAGE:
// 1. Add this indicator to the same chart as your main bounce indicator
// 2. Enable the alert types you want to monitor
// 3. Create alerts for each condition you're interested in
// 4. Use these alerts to prepare for and confirm your main bounce signals